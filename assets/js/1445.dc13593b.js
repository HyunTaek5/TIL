"use strict";(self.webpackChunktil=self.webpackChunktil||[]).push([[1445],{3905:(e,r,t)=>{t.d(r,{Zo:()=>p,kt:()=>f});var n=t(7294);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function a(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function c(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=n.createContext({}),s=function(e){var r=n.useContext(i),t=r;return e&&(t="function"==typeof e?e(r):a(a({},r),e)),t},p=function(e){var r=s(e.components);return n.createElement(i.Provider,{value:r},e.children)},u={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,l=e.originalType,i=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),d=s(t),f=o,m=d["".concat(i,".").concat(f)]||d[f]||u[f]||l;return t?n.createElement(m,a(a({ref:r},p),{},{components:t})):n.createElement(m,a({ref:r},p))}));function f(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var l=t.length,a=new Array(l);a[0]=d;var c={};for(var i in r)hasOwnProperty.call(r,i)&&(c[i]=r[i]);c.originalType=e,c.mdxType="string"==typeof e?e:o,a[1]=c;for(var s=2;s<l;s++)a[s]=t[s];return n.createElement.apply(null,a)}return n.createElement.apply(null,t)}d.displayName="MDXCreateElement"},1445:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>i,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>c,toc:()=>s});t(7294);var n=t(3905);function o(){return o=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},o.apply(this,arguments)}const l={title:"2023-10-23",tags:["AWS","CloudFlare","Vercel"]},a="\uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8 \ubc30\ud3ec \ud68c\uace0 \uae30\ub85d",c={unversionedId:"2023/2023-10/2023-10-23",id:"2023/2023-10/2023-10-23",title:"2023-10-23",description:"\uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8 \ubc30\ud3ec \uc774\uc288 \uc815\ub9ac",source:"@site/docs/2023/2023-10/2023-10-23.md",sourceDirName:"2023/2023-10",slug:"/2023/2023-10/2023-10-23",permalink:"/TIL/docs/2023/2023-10/2023-10-23",draft:!1,tags:[{label:"AWS",permalink:"/TIL/docs/tags/aws"},{label:"CloudFlare",permalink:"/TIL/docs/tags/cloud-flare"},{label:"Vercel",permalink:"/TIL/docs/tags/vercel"}],version:"current",frontMatter:{title:"2023-10-23",tags:["AWS","CloudFlare","Vercel"]},sidebar:"tutorialSidebar",previous:{title:"2023-10-21",permalink:"/TIL/docs/2023/2023-10/2023-10-21"},next:{title:"\uad6c\ub984 Commit - SRE",permalink:"/TIL/docs/events/\uad6c\ub984 Commit - SRE"}},i={},s=[{value:"1. NGINX \ub3c4\ucee4 \ucee8\ud14c\uc774\ub108 conf \uc801\uc6a9 \uc774\uc288",id:"1-nginx-\ub3c4\ucee4-\ucee8\ud14c\uc774\ub108-conf-\uc801\uc6a9-\uc774\uc288",level:2},{value:"2. Vercel \ubc30\ud3ec\uc2dc DNS &quot;err_too_many_redirects&quot; \uc774\uc288",id:"2-vercel-\ubc30\ud3ec\uc2dc-dns-err_too_many_redirects-\uc774\uc288",level:2},{value:"3. \uc6f9\uc11c\ubc84 DNS \uc811\uc18d \ubd88\uac00 &quot;Error 521: Web server is down&quot; \uc774\uc288",id:"3-\uc6f9\uc11c\ubc84-dns-\uc811\uc18d-\ubd88\uac00-error-521-web-server-is-down-\uc774\uc288",level:2}],p={toc:s};function u(e){var{components:r}=e,t=function(e,r){if(null==e)return{};var t,n,o={},l=Object.keys(e);for(n=0;n<l.length;n++)t=l[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,["components"]);return(0,n.kt)("wrapper",o({},p,t,{components:r,mdxType:"MDXLayout"}),(0,n.kt)("h1",o({},{id:"\uc0ac\uc774\ub4dc-\ud504\ub85c\uc81d\ud2b8-\ubc30\ud3ec-\ud68c\uace0-\uae30\ub85d"}),"\uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8 \ubc30\ud3ec \ud68c\uace0 \uae30\ub85d"),(0,n.kt)("p",null,"\uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8 \ubc30\ud3ec \uc774\uc288 \uc815\ub9ac"),(0,n.kt)("p",null,"\uae30\uc874\uc5d0 \uc791\uc5c5\ud558\ub358 ",(0,n.kt)("a",o({parentName:"p"},{href:"https://github.com/Fashion-Cloud"}),"\uc0ac\uc774\ub4dc \ud504\ub85c\uc81d\ud2b8")," POC \ubc1c\ud45c \uae30\uac04\uc774 \ubcc4\ub85c \ub0a8\uc9c0 \uc54a\uc558\uace0, AWS \ube44\uc6a9 \uc9c0\uc6d0\ub3c4 \ub098\uc640\uc11c ",(0,n.kt)("a",o({parentName:"p"},{href:"https://cloudtype.io/"}),"CloudType"),", ",(0,n.kt)("a",o({parentName:"p"},{href:"https://neon.tech/"}),"Neon")," \uc870\ud569\uc73c\ub85c \ubb34\ub8cc \ud50c\ub79c\uc744 \ud65c\uc6a9\ud574\uc11c \ubc30\ud3ec\ud574\ub450\uc5c8\ub358 \ubc31\uc5d4\ub4dc \uc778\ud504\ub77c\ub97c AWS \uae30\ubc18\uc73c\ub85c \ub9c8\uc774\uadf8\ub808\uc774\uc158\ud558\uace0, \ud504\ub860\ud2b8 \uc2e0\uaddc \ubc30\ud3ec\ub97c \uc9c4\ud589\ud558\uc600\ub2e4. \ubc30\ud3ec\ud558\uba74\uc11c \uc5ec\ub7ec \uc774\uc288 \uc0c1\ud669\uc774 \uc788\uc5c8\ub294\ub370 \ud574\ub2f9 \ud788\uc2a4\ud1a0\ub9ac\ub97c \uc815\ub9ac\ud574\ub450\uc5c8\ub2e4."),(0,n.kt)("p",null,"AWS \uc11c\ube44\uc2a4\uc758 \uacbd\uc6b0, \uae30\uc874\uc5d0 static \ud30c\uc77c \uc800\uc7a5 \uc2a4\ud1a0\ub9ac\uc9c0 \uc6a9\ub3c4\ub85c \uc0ac\uc6a9\ud558\ub358 S3\ub97c \uc720\uc9c0\ud55c \ucc44, EC2\ub97c \ucd94\uac00\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\uc600\ub2e4. EC2 \uc778\uc2a4\ud134\uc2a4 \uc720\ud615\uc758 \uacbd\uc6b0, \uc720\ud6a8\ud55c \ud2b8\ub798\ud53d\uc774 \uc5c6\ub294 \uc0c1\ud0dc\uc5d0\uc11c RDS \uc11c\ube44\uc2a4\ub97c \uc0ac\uc6a9\ud558\uae30\uc5d0\ub294 \ube44\uc6a9\uc801\uc73c\ub85c \ud300\uc6d0\ub4e4\uc5d0\uac8c \ubd80\ub2f4\uc774 \ub418\ubbc0\ub85c DB\ub97c \uc778\uc2a4\ud134\uc2a4 \ub0b4\ubd80\uc5d0 docker \ucee8\ud14c\uc774\ub108\ub85c \ub744\uc6b8 \uacc4\ud68d\uc73c\ub85c vCPU\uac00 2\uac1c\uc5d0 \uba54\ubaa8\ub9ac\uac00 2Gib\uc778 t3.small\ub97c \uc0ac\uc6a9\ud558\uc600\ub2e4."),(0,n.kt)("p",null,"DNS\uc758 \uacbd\uc6b0, CloudFlare\uc5d0\uc11c \ub3c4\uba54\uc778\uc744 \uc0ac\ub450\uc5c8\uace0, SSL/TLS \uc124\uc815\uc2dc \ud3b8\uc758\uc131\uc744 \uc704\ud574 CloudFlare\ub97c \uc0ac\uc6a9\ud558\uc600\ub2e4. "),(0,n.kt)("h2",o({},{id:"1-nginx-\ub3c4\ucee4-\ucee8\ud14c\uc774\ub108-conf-\uc801\uc6a9-\uc774\uc288"}),"1. NGINX \ub3c4\ucee4 \ucee8\ud14c\uc774\ub108 conf \uc801\uc6a9 \uc774\uc288"),(0,n.kt)("p",null,"SpringBoot \uae30\ubc18 \ubc31\uc5d4\ub4dc, Redis, DB, NGINX \ucd1d 3\uac1c\uc758 \uc11c\ube44\uc2a4\ub97c docker-compose\ub97c \uc0ac\uc6a9\ud574\uc11c \uad00\ub9ac\ud558\ub824\ud588\ub294\ub370 NGINX \ucee8\ud14c\uc774\ub108\uc5d0\uc11c \uc544\ub798\uc640 \uac19\uc740 \uc5d0\ub7ec\ucf54\ub4dc\uac00 \ubc1c\uc0dd\ud558\uba74\uc11c exitCode 1\uacfc \ud568\uaed8 \ucee8\ud14c\uc774\ub108\uac00 \ub0b4\ub824\uac00\ub294 \uc774\uc288\uac00 \ubc1c\uc0dd\ud558\uc600\ub2e4."),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-shell"}),"/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking for shell in /docker-entrypoint.d/\n")),(0,n.kt)("p",null,"\ud574\ub2f9 \uc6d0\uc778\uc740 nginx \ub3c4\ucee4\ud30c\uc77c\uacfc \uc0ac\uc6a9\ud558\ub824\ub358 nginx.conf \ud30c\uc77c\uc758 \uc124\uc815\uc774 \uc798\ubabb\ub418\uc5b4 \uc788\uc5b4\uc11c nginx\uac00 \uc2e4\ud589\ub418\uc9c0 \uc54a\uace0, \uc5d0\ub7ec\ub97c \ubc1c\uc0dd\uc2dc\ucf1c \uc0dd\uae30\ub294 \uc774\uc288\uc600\ub2e4. \ud574\ub2f9 \uc774\uc288\ub85c NGINX \uc774\ubbf8\uc9c0\ub97c docker-compose.yml\uc5d0\uc11c \uc81c\uac70\ud55c \ud6c4, \uc778\uc2a4\ud134\uc2a4 \ub0b4\ubd80\uc5d0 \uc9c1\uc811 NGINX\ub97c \uc124\uce58\ud558\uc5ec /etc/nginx/conf.d \ud3f4\ub354 \ub0b4\ubd80\uc5d0 prod.conf\ub85c \uc6f9\uc11c\ubc84 \uc124\uc815\uc744 \uc9c1\uc811 \uc7a1\uc544\uc8fc\ub294 \ubc29\uc2dd\uc73c\ub85c \ucc98\ub9ac\ud558\uc600\ub2e4."),(0,n.kt)("h2",o({},{id:"2-vercel-\ubc30\ud3ec\uc2dc-dns-err_too_many_redirects-\uc774\uc288"}),'2. Vercel \ubc30\ud3ec\uc2dc DNS "err_too_many_redirects" \uc774\uc288'),(0,n.kt)("p",null,'\ud504\ub860\ud2b8\uc5d4\ub4dc\uc758 \uacbd\uc6b0, NextJs \uae30\ubc18\uc73c\ub85c \uc791\ub3d9\ud558\ubbc0\ub85c NextJs \ud504\ub808\uc784\uc6cc\ud06c\ub97c \ub9cc\ub4e0 Vercel\uc5d0 \ubc30\ud3ec\ud558\ub294 \uac83\uc774 \uc548\uc815\uc131 \uce21\uba74\uc774\ub098 CI/CD \uc124\uc815 \uce21\uba74\uc5d0\uc11c\ub3c4 \ud3b8\uc758\uc131\uc744 \uac00\uc838\uac08 \uc218 \uc788\ub2e4\uace0 \ud310\ub2e8\ud558\uc600\ub2e4. Vercel\uacfc Github \ud504\ub860\ud2b8\uc5d4\ub4dc \ub808\ud3ec\ub97c \uc5f0\ub3d9\ud558\uace0, build\ud574\uc11c vercel \uc790\uccb4\uc801\uc778 \ub3c4\uba54\uc778\uc73c\ub85c \uc815\uc0c1\uc801\uc73c\ub85c \uc811\uadfc\uac00\ub2a5\ud55c \uac83\uae4c\uc9c0 \ud655\uc778 \ud6c4, \uad6c\ub9e4\ud558\uc600\ub358 \ub3c4\uba54\uc778\uacfc \uc5f0\ub3d9\ud558\uc600\ub294\ub370 \ud574\ub2f9 \ub3c4\uba54\uc778\uc73c\ub85c \uc811\uadfc\uc2dc "err_too_many_redirects" \ud398\uc774\uc9c0\uac00 \ub728\uba74\uc11c \ud398\uc774\uc9c0\ub85c \uc811\uadfc\uc774 \ubd88\uac00\ud558\uc600\ub2e4. '),(0,n.kt)("p",null,'\ud574\ub2f9 \uc774\uc288\uc758 \uc6d0\uc778\uc740 CloudFlare SSL/TLS \uc124\uc815 \ubb38\uc81c\uc600\ub2e4. CloudFlare\uc758 SSL/TLS \uc124\uc815\uc744 \uac00\ubcc0 \uc635\uc158\uc73c\ub85c \uc124\uc815\ud574\ub450\uace0 \uc4f0\uace0 \uc788\uc5c8\ub294\ub370 \uac00\ubcc0 \uc635\uc158 \uc0ac\uc6a9\uc2dc, CloudFlare\uac00 HTTP\ub85c Vercel \ubc30\ud3ec \uc8fc\uc18c\uc5d0 \uc811\uadfc \ud6c4, Vercel\uc758 \uc751\ub2f5\uc5d0 \ub530\ub77c HTTPS\ub97c \uc0ac\uc6a9\ud574\uc11c \uc751\ub2f5\uc744 \ud3ec\uc6cc\ub529\ud574\uc8fc\ub294 \ubc29\uc2dd\uc774\uc5c8\ub2e4. \uc5ec\uae30\uc11c \ubb38\uc81c\ub294 Vercel\uc774 CloudFlare\ub85c \uc751\ub2f5\ud560 \ub54c, \uc790\ub3d9\uc73c\ub85c HTTP \uc694\uccad\uc744 HTTPS\ub85c \uc5c5\uadf8\ub808\uc774\ub4dc\ud558\uc5ec 308 \ucf54\ub4dc\ub97c \uc804\uc1a1\ud558\ubbc0\ub85c \ub3d9\uc77c\ud55c \uc704\uce58\ub85c \ub9ac\ub2e4\uc774\ub809\ud2b8 \ub418\uc5b4 \ub8e8\ud504\uc5d0 \ube60\uc9c0\uac8c\ub41c\ub2e4. CloudFlare\uc758 SSL/TLS \uc635\uc158\uc744 "\uc804\uccb4(\uc5c4\uaca9)" \uc635\uc158\uc73c\ub85c \ubcc0\uacbd\ud558\uc5ec \ud574\ub2f9 \uc774\uc288\ub97c \ucc98\ub9ac\ud558\uc600\ub2e4.'),(0,n.kt)("h2",o({},{id:"3-\uc6f9\uc11c\ubc84-dns-\uc811\uc18d-\ubd88\uac00-error-521-web-server-is-down-\uc774\uc288"}),'3. \uc6f9\uc11c\ubc84 DNS \uc811\uc18d \ubd88\uac00 "Error 521: Web server is down" \uc774\uc288'),(0,n.kt)("p",null,"Vercel\uacfc CloudFlare \uc5f0\ub3d9\uc774 \uc644\ub8cc\ub41c \uc774\ud6c4, api \uc11c\ubc84\uc5d0 \uc5f0\ub3d9\ud574\ub450\uc5c8\ub358 \ub3c4\uba54\uc778\uc73c\ub85c \uc811\uadfc\uc2dc,  CloudFlare\uc758 521 \uc5d0\ub7ec \ud398\uc774\uc9c0\uac00 \ub728\ub294 \uc774\uc288\uac00 \uc788\uc5c8\ub2e4. api \uc11c\ubc84\uc5d0 \uc5d0\ub7ec\uac00 \ubc1c\uc0dd\ud558\uc5ec NGINX \uc11c\ube44\uc2a4\uac00 down\ub41c \uac83\uc73c\ub85c \ucd94\uc815\ud558\uc5ec ssh\ub85c EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 \uc811\uadfc\ud558\uc5ec \uc0c1\ud0dc \ud655\uc778 \uacb0\uacfc docker \ucee8\ud14c\uc774\ub108\uc640 NGINX \uc11c\ube44\uc2a4 \ubaa8\ub450 \uc815\uc0c1\uc801\uc73c\ub85c \ub3d9\uc791\ud558\uace0 \uc788\uc5c8\ub2e4."),(0,n.kt)("p",null,'\ud574\ub2f9 \uc774\uc288\uc758 \uc6d0\uc778\uc740 Vercel\uacfc CloudFlare \uc5f0\ub3d9 \uc774\uc288\ub97c \ucc98\ub9ac\ud558\uba74\uc11c CloudFlare SSL/TLS \uc635\uc158\uc744 "\uc804\uccb4(\uc5c4\uaca9)" \uc635\uc158\uc73c\ub85c \ubcc0\uacbd\ud55c \uac83\uc774\uc5c8\ub2e4. SSL/TLS \uc635\uc158\uc744 "\uc804\uccb4(\uc5c4\uaca9)"\uc73c\ub85c \uc0ac\uc6a9\ud558\uba74, \uc5d4\ub4dc\ud22c\uc5d4\ub4dc\ub85c \ube0c\ub77c\uc6b0\uc800 - CloudFlare - \uc11c\ubc84 \uc804\uccb4 \ud2b8\ub798\ud53d\ub2e8\uc744 \uc554\ud638\ud654\ud558\uae30\uc704\ud574 CloudFlare\uac00 \uc81c\uacf5\ud558\ub294 CA \uc778\uc99d\uc11c\uac00 \uc6f9\uc11c\ubc84\uc5d0 \ub4f1\ub85d\ub418\uc5b4 \uc788\uc5b4\uc57c\ud588\ub2e4. '),(0,n.kt)("p",null,"EC2 \uc778\uc2a4\ud134\uc2a4\uc5d0 /etc/ssl \ub514\ub809\ud1a0\ub9ac\uc5d0 CloudFlare\uc5d0\uc11c \uc81c\uacf5\ud558\ub294 ssl \uc778\uc99d pem \ud30c\uc77c\uacfc key \ud30c\uc77c\uc744 \ucd94\uac00\ud574\ub450\uace0, NGINX\uc758 prod.conf \uc124\uc815\ud30c\uc77c\uc5d0 443 \ud3ec\ud2b8\ub97c \uc5f4\uc5b4\ub450\uace0 ssl \uad00\ub828 \uc124\uc815\uc744 \uc801\uc6a9\ud558\uc5ec \ud574\ub2f9 \uc774\uc288\ub97c \ucc98\ub9ac\ud558\uc600\ub2e4."),(0,n.kt)("pre",null,(0,n.kt)("code",o({parentName:"pre"},{className:"language-vim"}),"server {\n    listen   443;\n\n    ssl    on;\n    ssl_certificate    /etc/ssl/your_domain_name.pem;\n    ssl_certificate_key    /etc/ssl/your_domain_name.key;\n    ....\n}\n")))}u.isMDXComponent=!0}}]);